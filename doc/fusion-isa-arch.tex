\documentclass[letterpaper, 11pt]{article}
\usepackage{graphicx}
\usepackage[left=1in, right=1in, top=1.00in, bottom=1.00in]{geometry}
\usepackage{subfigure}
\usepackage{hyperref}
\hypersetup{colorlinks=false,linktoc=all}



\title{Fusion-Core ISA Definition: Revision 0.1}
\author{Dylan Wadler}

\begin{document}
\maketitle
\newpage
\tableofcontents


\newpage
\section{Change log}
\paragraph{Version 0.1} Initial Definition of the Instruction Set Architecture

\section{Introduction}

\subsection{About}
\paragraph{}The Fusion-Core ISA is dedicated to creating an easily expandible architecture without altering
the instruction set. By use of defining an easy interface with a simple core instruction set, this allows for
more freedom in implementation. High end processors and microcontrollers would only have slight varaitions in
configuration, as their core would remain identical save for easy to maintain and scalable co-processors.
\paragraph{}The architecture is Big endian, with a core instruction set that is RISC, but the co-processors do not need to adhere to the RISC philosophy. This allows for more flexibility in design, and possibly faster core clock speeds as the pipeline would depend on smaller amounts of logic. Only the instructions provided in this document are to be implemented in the main processor. The co-processors defined in this document are recommended, but not required for normal function. Co-processor documentation is to be provided by the creator, and should adhere to the standards of clarity and conciseness such that it can be easily implemented from the documentation alone in a HDL. 
\paragraph{64 Bit instructions:}At this moment in time, the Fusion-Core ISA is only a 32 bit ISA. Due to the focus on co-processors,
older implementations could easily be modified to include 64 bit operations.


\subsection{Goals}
\subsection{Conventions}
\paragraph{Document Conventions:}Example code will be shown with \texttt{monospace} text. General purpose registers will be denoted with
\$R\# where \# is the number of the register. Special purpose registers will be presented with \textbf{bold} text.
\paragraph{Naming Conventions:}The name of input signals will have "\_in" after the signal name, with "\_out" after output signals.
This is mainly used in the verilog example implementation. If a naming convention is not globally used, it will be stated in the individual section that it pertains to. 


\section{Register File Definitions}
\paragraph{}This section goes over the different registers available in the ISA. Each register file name begins with 
"REGF", such as the first General Purpose Register File being REGFGP0. Any additional register files require the number after the
name of the register file. Register files with additional numbers after them are bank switched to reduce space, hence why the number is
required to denote the register file space used.
\paragraph{}To alleviate context switching delays, three general purpose register files are bank availble by bank switching. Only these register files are required
for a minimal system, though more can certainly be implemented if required. Each register file can be accessed by changing the value in the BSELRF register. 
\subsection{Register File List}
	\begin{figure}[!h]
		\caption{General Purpose Registers}
	%	\begin{center}
		\parbox{0.05\linewidth}{
			\centering
			\fontsize{6}{8}\selectfont
			\begin{tabular}{|l|l|}
				\hline
				\multicolumn{2}{|c|}{REGFGP0} \\
				\hline
				Register & Register Name \\ \hline
				\$R0  & ZERO \\ 	\hline
				\$R1  & SP0 \\ 	\hline
				\$R2  & FP0 \\ 	\hline
				\$R3  & GP0 \\ 	\hline
				\$R4  & RA0 \\ 	\hline
				\$R5  & ARG00 \\ 	\hline
				\$R6  & ARG01 \\ 	\hline
				\$R7  & ARG02 \\ 	\hline
				\$R8  & ARG03 \\ 	\hline
				\$R9  & RVAL00 \\ 	\hline
				\$R10 & RVAL01 \\ \hline
				\$R11 & GR00  \\ \hline
				\$R12 & GR01  \\ \hline
				\$R13 & GR02  \\ \hline
				\$R14 & GR03  \\ \hline
				\$R15 & GR04  \\ \hline
				\$R16 & GR05  \\ \hline
				\$R17 & GR06  \\ \hline
				\$R18 & GR07  \\ \hline
				\$R19 & GR08  \\ \hline
				\$R20 & GR09  \\ \hline
				\$R21 & GR10  \\ \hline
				\$R22 & TMP00  \\ \hline
				\$R23 & TMP01 \\ \hline
				\$R24 & TMP02  \\ \hline
				\$R25 & TMP03  \\ \hline
				\$R26 & TMP04  \\ \hline
				\$R27 & TMP05  \\ \hline
				\$R28 & TMP06  \\ \hline
				\$R29 & TMP07  \\ \hline
				\$R30 & HI0  \\ \hline
				\$R31 & LOW0  \\ \hline
			\end{tabular}
		}
		\hfill
		\parbox{0\linewidth}{
			\centering
			\fontsize{6}{8}\selectfont
			\begin{tabular}{|l|l|}
				\hline
				\multicolumn{2}{|c|}{REGFEXCP} \\
				\hline
				Register & Register Name \\ \hline
				\$R0  & ZERO \\ 	\hline
				\$R1  & SP1 \\ 	\hline
				\$R2  & FP1 \\ 	\hline
				\$R3  & GP1 \\ 	\hline
				\$R4  & RA1 \\ 	\hline
				\$R5  & ARG0 \\ 	\hline
				\$R6  & ARG1 \\ 	\hline
				\$R7  & ARG2 \\ 	\hline
				\$R8  & ARG3 \\ 	\hline
				\$R9  & ARG4 \\ 	\hline
				\$R10 & ARG5 \\ \hline
				\$R11 & RVAL0  \\ \hline
				\$R12 & RVAL1  \\ \hline
				\$R13 & RVAL2  \\ \hline
				\$R14 & RVAL3  \\ \hline
				\$R15 & RVAL4  \\ \hline
				\$R16 & GPR0  \\ \hline
				\$R17 & GPR1  \\ \hline
				\$R18 & GPR2  \\ \hline
				\$R19 & GPR3  \\ \hline
				\$R20 & GPR4  \\ \hline
				\$R21 & GPR5  \\ \hline
				\$R22 & GPR6  \\ \hline
				\$R23 & GPR7  \\ \hline
				\$R24 & TMPR0  \\ \hline
				\$R25 & TMPR1  \\ \hline
				\$R26 & TMPR2  \\ \hline
				\$R27 & TMPR3  \\ \hline
				\$R28 & TMPR4  \\ \hline
				\$R29 & TMPR5  \\ \hline
				\$R30 & REGHI1  \\ \hline
				\$R31 & REGLOW1  \\ \hline
			\end{tabular}
		}
		\hfill
		\parbox{0.25\linewidth}{
			\centering\fontsize{6}{8}\selectfont.5
			\fontsize{6}{8}\selectfont
			\begin{tabular}{|l|l|}
				\hline
				\multicolumn{2}{|c|}{REGFSYSCL0} \\
				\hline
				Register & Register Name \\ \hline
				\$R0  & ZERO \\ 	\hline
				\$R1  & SP1 \\ 	\hline
				\$R2  & FP1 \\ 	\hline
				\$R3  & GP1 \\ 	\hline
				\$R4  & RA1 \\ 	\hline
				\$R5  & SYSARG00 \\ 	\hline
				\$R6  & SYSARG01 \\ 	\hline
				\$R7  & SYSARG02 \\ 	\hline
				\$R8  & SYSARG03 \\ 	\hline
				\$R9  & SYSARG04 \\ 	\hline
				\$R10 & SYSARG05 \\ \hline
				\$R11 & SYSRVAL00  \\ \hline
				\$R12 & SYSRVAL01  \\ \hline
				\$R13 & SYSRVAL02  \\ \hline
				\$R14 & SYSRVAL03  \\ \hline
				\$R15 & SYSRVAL04  \\ \hline
				\$R16 & SYSGPR00  \\ \hline
				\$R17 & SYSGPR01  \\ \hline
				\$R18 & SYSGPR02  \\ \hline
				\$R19 & SYSGPR03  \\ \hline
				\$R20 & SYSGPR04  \\ \hline
				\$R21 & SYSGPR05  \\ \hline
				\$R22 & SYSGPR06  \\ \hline
				\$R23 & SYSGPR07  \\ \hline
				\$R24 & SYSTMPR00  \\ \hline
				\$R25 & SYSTMPR01  \\ \hline
				\$R26 & SYSTMPR02  \\ \hline
				\$R27 & SYSTMPR03  \\ \hline
				\$R28 & SYSTMPR04  \\ \hline
				\$R29 & SYSTMPR05  \\ \hline
				\$R30 & SYSREGHI0  \\ \hline
				\$R31 & SYSREGLOW0  \\ \hline
			\end{tabular}
		}
%		\end{center}
	\end{figure}
	\begin{figure}
		\caption{Special Registers}
		\parbox{0\linewidth}{
			\centering
			\fontsize{6}{8}\selectfont
			\begin{tabular}{|l|l|l|}
				\hline
				\multicolumn{3}{|c|}{Control Registers} \\
				\hline
					Register Name & Description & Address (Hex) \\ \hline
					CPUREV  & CPU Revision 							& 0x00000000\\ 	\hline
					CPO0  	& Co-Processor 0 Information 			& 0x00000004\\ 	\hline
					CPO1  	& Co-Processor 1 Information 			& 0x00000008\\ 	\hline
					CPO2  	& Co-Processor 2 Information 			& 0x0000000c\\ 	\hline
					CPO3  	& Co-Processor 3 Information 			& 0x00000010\\ 	\hline
					STATUS  & Status Register						& 0x00000014 \\ 	\hline
					\$
			\end{tabular}
		}
		\hfill
		\parbox{0.4 \linewidth}{
			\centering
			\fontsize{6}{8}\selectfont
			\begin{tabular}{|l|l|l|}
				\hline
				\multicolumn{3}{|c|}{Supervisor Registers} \\
				\hline
					Register Name & Description & Address (Hex)\\ \hline
					SMSTAT & Supervisor mode status register & 0x00000000 \\ 	\hline
				    PRCPR0 & Process Pointer register 0 & 0x00000004	\\ \hline 
			\end{tabular}
		}
	\end{figure}
\subsection{General Purpose Registers}
\paragraph{}32 general purpose registers that are 32 bits wide are available, as shown in Figure 1, in the previous section. 
	

\paragraph{NOTE:} In writing programs, register arguments and return values can be used to reduce the number of registers used between processes. 

\paragraph{}While it is not defined by the architecture, larger general purpose registers can be used instead of 32 bit wide registers. 
If larger registers are needed, consider using a co-processor to for instructions that require larger operands. 
This provides code compatibility between different implementations.
\subsection{Special Registers}
\paragraph{}The special registers are sorted between the Control Registers and the Supervisor Registers. The control registers provide
simple configuration values and some read-only registers to give the programmer information about the implementation. The supervisor
registers provide control for 
\subsubsection{Control Registers}
\paragraph{CPUREV} Read only register that lets the programmer know what revision the CPU is. \\
\begin{center}
	\begin{tabular}{|c|c|c|c|c|c|}
		\hline
			\multicolumn{6}{|c|}{CPUREV: CPU Revision} \\
		\hline
		\hline
		
	\end{tabular}
\end{center}


\paragraph{Bank Switching} Bank switching is controlled by the \textbf{BSELRF} register\\
\begin{center}
		\begin{tabular}{|c|c|c|c|c|}
		\hline
		\hline
		\hline
		
	\end{tabular}
\end{center}	


\subsubsection{Supervisor Registers}
\subsection{Adding Registers}


\section{Instruction Definitions}
\subsection{Instruction Format Types}
\paragraph{}This section will talk about the different instructions available in the core processor, their encodings, function, and hazards
they cause or registers they affect in the processor. The Co-Processor instructions are purlely generic and allow the implementation of
each Co-Processor to determine how their respective instructions will be decoded. Only the Operation Codes will be defined for each 
Co-Processor slot to allow for more customization.
\subsubsection{Integer}
\paragraph{}The interger instructions are the heart of this processor's arithmetic abilities and is vital to ensure fast execution. A semi-strict
adherence to RISC philosophy in this architecture is required to exploit any benefits to this ISA in a real implementation.
\paragraph{}The integer instruction coding with descriptions, is shown in the diagrams below.

\begin{center}
		\begin{tabular}{|c|c|c|c|c|c|}
			\multicolumn{6}{c}{Register/Integer Instruction Format}\\ \hline
				\hspace{2pt} opcode (0x01) \hspace{2pt} & \hspace{5pt} rd \hspace{5pt} &  \hspace{4pt} rsa \hspace{4pt} & \hspace{4pt}rsb  \hspace{4pt}& \hspace{10pt}shft  \hspace{10pt} & \hspace{3pt} aluop \hspace{3pt}   \\	\hline
			31 \hfill 26& 25 \hfill 21 &20 \hfill  16& 15 \hfill  11&10 \hfill   4&3 \hfill   0\\ \hline
		
	\end{tabular}
\end{center}	
\paragraph{Overview:}The Register/Integer Instructions are basic ALU operations, without immediates. Registers RSa and RSb are the two operands,which
are stored in register Rd. The 4 bit ALUOP field denotes the settings for the ALU, to reduce complexity of selecting what operation to choose.
The shft bits are only for the shift amount with the shifting instructions, but unused for other instructions. 
\paragraph{}The following instructions use this encoding:



\subsubsection{Immediate}

\begin{center}
		\begin{tabular}{|c|c|c|c|c|}
			\multicolumn{5}{c}{Immediate Instruction Format}\\ \hline
				\hspace{2pt} opcode \hspace{2pt} & \hspace{5pt} rd \hspace{5pt} &  \hspace{4pt} rsa \hspace{4pt} & \hspace{10pt}Immediate  \hspace{10pt} & \hspace{3pt} aluop \hspace{3pt}   \\	\hline
			31 \hfill 26& 25 \hfill 21 &20 \hfill  16& 15  \hfill   4&3 \hfill   0\\ \hline
		
	\end{tabular}
\end{center}

\subsubsection{Load/Store}
\begin{center}
		\begin{tabular}{|c|c|c|c|}
			\multicolumn{4}{c}{Load Instruction Format}\\ \hline
				\hspace{2pt} opcode \hspace{2pt} & \hspace{5pt} rd \hspace{5pt} &  \hspace{4pt} rsa \hspace{4pt} & \hspace{10pt} Immediate \hspace{10pt}   \\	\hline
			31 \hfill 26& 25 \hfill 21 &20 \hfill  16& 15 \hfill 0\\ \hline
		
	\end{tabular}
\end{center}
\vspace{0.5cm}
\begin{center}
		\begin{tabular}{|c|c|c|c|}
				\multicolumn{4}{c}{Load Immediate Instrution Format}\\ \hline
				\hspace{2pt} opcode \hspace{2pt} & \hspace{5pt} rd \hspace{5pt} &  \hspace{4pt} DSEL \hspace{4pt} & \hspace{10pt}Immediate  \hspace{10pt}   \\	\hline
			31 \hfill 26& 25 \hfill 21 &20 \hfill  16& 15  \hfill   0\\ \hline
		
	\end{tabular}
\end{center}
\vspace{0.5cm}

\begin{center}
		\begin{tabular}{|c|c|c|c|c|}
			\multicolumn{5}{c}{Store Instruction Format}\\ \hline
				\hspace{2pt} opcode \hspace{2pt} & \hspace{5pt} Immediate[15:11] \hspace{5pt} &  \hspace{4pt} rsa \hspace{4pt} & \hspace{4pt}rsb  \hspace{4pt}& \hspace{10pt}Immediate[10:0]  \hspace{10pt}    \\	\hline
			31 \hfill 26& 25 \hfill 21 &20 \hfill  16& 15 \hfill  11&10 \hfill  0\\ \hline
		
	\end{tabular}
\end{center}
\subsubsection{Branch/Jump}

\begin{center}
		\begin{tabular}{|c|c|c|c|}
			\multicolumn{4}{c}{Jump Instruction Format}\\ \hline
				\hspace{2pt} opcode \hspace{2pt} & \hspace{5pt} rd \hspace{5pt} &  \hspace{4pt} rsa \hspace{4pt} & \hspace{10pt} Immediate  \hspace{10pt}   \\	\hline
							31 \hfill 26& 25 \hfill 21 &20 \hfill  16& 15 \hfill   0\\ \hline
		
	\end{tabular}
\end{center}	


\begin{center}
		\begin{tabular}{|c|c|c|c|c|c|}
			\multicolumn{6}{c}{Branch Instruction Format}\\ \hline
				\hspace{2pt} opcode \hspace{2pt} & \hspace{5pt} Immediate[11:7] \hspace{5pt} &  \hspace{4pt} rsa \hspace{4pt} & \hspace{4pt}rsb  \hspace{4pt}& \hspace{10pt}Immediate[6:0]  \hspace{10pt} & \hspace{3pt} aluop \hspace{3pt}   \\	\hline
			31 \hfill 26& 25 \hfill 21 &20 \hfill  16& 15 \hfill  11&10 \hfill   4&3 \hfill   0\\ \hline
		
	\end{tabular}
\end{center}

\begin{center}
		\begin{tabular}{|c|c|c|c|}
			\multicolumn{4}{c}{System instruction}\\ \hline
				\hspace{2pt} opcode \hspace{2pt} & \hspace{5pt} rd \hspace{5pt} &  \hspace{4pt} rsa \hspace{4pt} & \hspace{10pt}Immediate  \hspace{10pt}  \\	\hline
			31 \hfill 26& 25 \hfill 21 &20 \hfill  16& 15  \hfill   0\\ \hline
		
	\end{tabular}
\end{center}

\subsubsection{Co-Processor}

\begin{center}
		\begin{tabular}{|c|c|c|c|c|c|}
				\multicolumn{6}{c}{Co-Processor Instruction Format}\\ \hline
				\hspace{2pt} opcode \hspace{2pt} & \hspace{5pt} rd \hspace{5pt} &  \hspace{4pt} rsa \hspace{4pt} & \hspace{4pt}rsb  \hspace{4pt}& \hspace{10pt}shft  \hspace{10pt} & \hspace{3pt} aluop \hspace{3pt}   \\	\hline
			31 \hfill 26& 25 \hfill 21 &20 \hfill  16& 15 \hfill  11&10 \hfill   4&3 \hfill   0\\ \hline
		
	\end{tabular}
\end{center}	
\subsection{List of OPCodes}
\subsection{List of Instructions}
\subsubsection{Integer}
\subsubsection{Immediate}
\subsubsection{Load/Store}
\subsubsection{Branch/Jump}
\subsubsection{Co-Processor}



\section{Exceptions and Interrupts}
\subsection{Exceptions}


\subsection{Interrupts}
\subsubsection{User Level}
\subsubsection{Supervisor Level}

\section{Co-Processors}
\paragraph{}Co-processors are the main point of the Fusion-Core archetecture. As the ISA only defines the main core, the implementator is free to use
whichever co-processors that would be necessary for an application. Hardware acceleration for vector instructions, encryption, floating point, communication,
etc. There is no limitation for what kind of co-processor that could be used, only the number that could fit within the defined usable instructions.
\paragraph{}It is important to note that the co-processors do not need to be of a RISC construction, due to this reliance on co-processors without
specifying how they should be implemented. The main core is indeed RISC, as only the simplest instructions are defined that something as small as a microcontroller
could use without issue.
\paragraph{}The idea behind the separation of processor is to create different pipelines for each core. In doing so, the main core could be clocked faster that of
a pipeline requiring integer multiplication, or some other time consuming operation. As well, the individual cores could be clocked at their respective 
fastest frequencies, thus resulting in the fastest possible performance of each part. To deal with writing to memory with varying clock speeds for each core,
a FIFO buffer is used to send each write to main memory. This FIFO is to create the illusion of write atomicity. The FIFO should have connections to allow
for a seeming atomic read though, the programmer should note that reads require care; if there is a dependancy on a slow core's written value. This programming 
paradigm is similar to that of parallel threads, where certain values may not be available until an unknown time. The ISA does not define any particular ways
to handle this and it is either left up to the implementation, or programmer depending.
\paragraph{}As shown in the instruction section, there are predefined regions for the co-processor slots. 
This is defined to allow for the compiler/assembler to work across implementations. At this time, only a fixed number of co-processors can be used on 
an implementation at a time, though future expansions to the ISA may change this.  

\subsection{Co-Processor Interface}
\paragraph{}The interface is designed to be extremely simple, as to make co-processors easy to implement. The inputs is just the output from the instruction fetch
passthrough on the decode unit. As shown in the instruction list, there is a section of 6 bits for the co-processor's opcode. Please also note
that this section of the instruction is different than the opcode , 0x3f (may change to 0x20 to allow for more opcodes for the co-processors) , which indicates that the instruction is for the co-processor. To save connections, 
the normal opcode section is removed, leaving 26 bit physical instructions. Using more bits per instruction is not supported at this time, though it is possible
to take the instruction fetch output directly. 
\subsubsection{Co-Processor Conventions}
\subsubsection{Register Connections}
\subsubsection{Decode unit Connections}
\subsection{Interface Connection Definitions}
\subsection{Adding custom Co-Processor}
\subsection{List of Co-Processors}
\subsubsection{Floating Point}
\subsubsection{System Unit}
\subsubsection{Memory Management Unit}
\subsubsection{Multiprocessor Commnuication Unit}

\section{Recommended Co-Processors}
\subsection{Floating Point Unit}
\subsubsection{Registers}
\subsubsection{Instructions}
\subsection{System Unit}
\subsubsection{Registers}
\subsubsection{Instructions}
\subsection{Memory Management Unit}
\subsubsection{Registers}
\subsubsection{Instructions}
\subsection{Multiprocessor Communication Unit}
\subsubsection{Registers}
\subsubsection{Instructions}

\section{Memory Map}
\textbf{NOTE}
This section may not remain and be left up to the implementation. Do not use without consulting
the documentation of the implementation.
\section{Programming Conventions}
\subsection{Register Usage}
\subsection{Memory Locations for Vector Table}
\subsubsection{Interrupt Vector Table}
\subsubsection{Exception Vector Table}


\begin{figure}[!h]
	\begin{center}
		\begin{tabular}{|l|l|}
			\hline
			Address (32 bit) &  Definition\\ \hline
			0x0000 & Reset address \\ 	\hline
			0x0000 &  \\ 	\hline
			0x0000 &  \\ 	\hline
			0x0000 &  \\ 	\hline
			0x0000 &  \\ 	\hline
			0x0000 &  \\	\hline
		\end{tabular} 
		\caption{Exception Vector Table}
	\end{center}
	
\end{figure}




\end{document}
