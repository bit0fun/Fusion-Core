/*
  This file is part of Fusion-Core-ISA.

    Fusion-Core-ISA is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Fusion-Core-ISA is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Fusion-Core-ISA.  If not, see <http://www.gnu.org/licenses/>.
*/

module General_Purpose_Regs(
	/*Data*/
	input[31:0] d_in, //input data
	output[31:0] out_a, //register outputs
	output[31:0] out_b,

	/*Address*/
	input[4:0] addr_a,
	input[4:0] addr_b,
	
	/*Control Lines*/
	input[1:0] file_sel, //register file select lines
	input rw, //rw == 1, then read; rw == 0, write
	input clk //clock for synchronous registers
	);

	/*Registers*/
	reg [3:0] gp_sel; //selection line for register files

	/*Wires*/
	wire [31:0] w_out_a;
	wire [31:0] w_out_b;
	

	/*Instantiations of GP register files*/
RegisterFile GPRF0(
	.in_reg(d_in), //only one input needed
	.out_a(w_out_a),
	.out_b(w_out_b),
	.addr_a(addr_a), //used for input addresses
	.addr_b(addr_b),
	.rw(rw), //rw == 1, then read; rw == 0, write
	.clk(clk), //clock for synchronous registers
	.sel(gp_sel[0])
	);

RegisterFile GPRF1(
	.in_reg(d_in), //only one input needed
	.out_a(w_out_a),
	.out_b(w_out_b),
	.addr_a(addr_a), //used for input addresses
	.addr_b(addr_b),
	.rw(rw), //rw == 1, then read; rw == 0, write
	.clk(clk), //clock for synchronous registers
	.sel(gp_sel[1])
	);

RegisterFile GPRF2(
	.in_reg(d_in), //only one input needed
	.out_a(out_a),
	.out_b(out_b),
	.addr_a(addr_a), //used for input addresses
	.addr_b(addr_b),
	.rw(rw), //rw == 1, then read; rw == 0, write
	.clk(clk), //clock for synchronous registers
	.sel(gp_sel[2])
	);

RegisterFile GPRF3(
	.in_reg(d_in), //only one input needed
	.out_a(out_a),
	.out_b(out_b),
	.addr_a(addr_a), //used for input addresses
	.addr_b(addr_b),
	.rw(rw), //rw == 1, then read; rw == 0, write
	.clk(clk), //clock for synchronous registers
	.sel(gp_sel[3])
	);


initial
	begin
		 gp_sel <= 4'b1111; //no register file is selected at initialization
	end

//select is active low
always@(*)
begin
	case(file_sel)
		2'b00: gp_sel <= 4'b1110;
		2'b01: gp_sel <= 4'b1101;
		2'b10: gp_sel <= 4'b1011;
		2'b11: gp_sel <= 4'b0111;
	endcase
end






endmodule
